{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>My Bookings</h2>
        <p class="text-muted">View and manage your temple visit bookings</p>
    </div>
</div>

{% if bookings %}
<div class="row">
    {% for booking in bookings %}
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">{{ booking.temple.name if booking.temple else 'Temple Visit' }}</h6>
                <span class="badge bg-success">Confirmed</span>
            </div>
            <div class="card-body">
                <p><i class="bi bi-geo-alt"></i> {{ booking.temple.location if booking.temple else 'Gujarat, India' }}</p>
                <p><i class="bi bi-calendar"></i> {{ booking.date.strftime('%B %d, %Y') }}</p>
                <p><i class="bi bi-clock"></i> {{ booking.time_slot }}</p>
                <p><i class="bi bi-people"></i> {{ booking.persons }} person{{ 's' if booking.persons > 1 else '' }}</p>
                <p><i class="bi bi-currency-rupee"></i> ₹50</p>
                {% if booking.confirmation_id %}
                <p><i class="bi bi-check-circle"></i> Confirmation: <code>{{ booking.confirmation_id }}</code></p>
                {% endif %}
                {% for order in booking.orders %}
                <div class="alert alert-success mt-2">
                    <h6><i class="bi bi-qr-code"></i> {% if order.total_amount > 0 %}Pre-booked Services{% else %}Darshan Entry{% endif %}</h6>
                    <div class="row">
                        <div class="col-md-8">
                            <p><strong>QR Code:</strong> <code>{{ order.qr_code }}</code></p>
                            {% if order.total_amount > 0 %}
                            <p><strong>Services Amount:</strong> ₹{{ order.total_amount }}</p>
                            {% endif %}
                            <p><strong>Darshan Fee:</strong> ₹{{ booking.persons * 50 }}</p>
                            <p><strong>Status:</strong> 
                                <span class="badge bg-{{ 'success' if order.status == 'collected' else 'warning' }}">
                                    {{ order.status.title() }}
                                </span>
                            </p>
                            <small class="text-muted">Show this QR code at temple {% if order.total_amount > 0 %}Pre-booked Collection counter{% else %}entrance for verification{% endif %}</small>
                        </div>
                        <div class="col-md-4 text-center">
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data={{ order.qr_code }}" alt="QR Code" class="img-fluid">
                        </div>
                    </div>
                </div>
                {% endfor %}
                <small class="text-muted">Booked on: {{ booking.created_at.strftime('%B %d, %Y at %I:%M %p') }}</small>
            </div>
            <div class="card-footer">
                <a href="{{ url_for('temple_detail', temple_id=booking.temple_id) if booking.temple_id else url_for('temples') }}" class="btn btn-outline-primary btn-sm">View Temple</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5">
    <i class="bi bi-calendar-x fs-1 text-muted"></i>
    <h4 class="mt-3">No Bookings Yet</h4>
    <p class="text-muted">You haven't made any temple bookings yet.</p>
    <a href="{{ url_for('temples') }}" class="btn btn-primary">Explore Temples</a>
</div>
{% endif %}
{% endblock %}